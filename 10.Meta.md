# 10. Meta <!-- omit in toc -->

# 1. Crear la carpeta meta/

# 2. Crear archivo main.tf

```tf
resource "local_file" "tempfile" {
  filename          = "tempfile"
  sensitive_content = "password: S3cr3tP@ssw0rd"
  count             = 3
}
```

# 3. Aplicar

> Se genera un solo archivo aunque tenga el argumento **count**
>
> Se debe al nombre, este argumento es único.

```vim
+ sensitive_content    = (sensitive value)

local_file.tempfile[0]: Creating...
local_file.tempfile[1]: Creating...
local_file.tempfile[2]: Creating...
```

# 4. Crear el archivo variables.tf
```tf
variable "users" {
  type    = list(string)
  default = ["user01", "user02", "user03"]
}
```

# 5. modificar el main.tf
```tf
  filename          = var.users[count.index]
  count             = length(var.users)
```

> Crea tres archivos con nombres distintos.


# 6. Reparar el warning:
> Warning: Argument is deprecated

> [info](https://registry.terraform.io/providers/hashicorp/local/latest/docs/resources/sensitive_file)

# 7. Eliminar el índice [0] de la lista = user01 y aplicar
```tf
default = ["user02", "user03"]
```

```vim
local_file.tempfile[0]: Destruction complete after 0s
local_file.tempfile[1]: Destruction complete after 0s
local_file.tempfile[2]: Destruction complete after 0s

local_file.tempfile[0]: Creation complete after 0s
local_file.tempfile[1]: Creation complete after 0s
```
> Elimina los tres archivos y recrea los dos restantes.
>
> Se debe a que los recursos están referenciados por el índice **count**

# 8. Destruir y borrar el recurso "tempfile"

# 9. Agregar a main.tf
```tf
resource "local_sensitive_file" "tempfile_for" {
  filename          = each.value
  for_each          = toset(var.users)
  content = "password: S3cr3tP@ssw0rd"
}
```

> El argumento **for_each** acepta valores tipo set (list sin items repetidos)

# 10. Eliminar el elemento USER03 de la lista y aplicar
```vim
local_file.tempfile_for["user03"] will be destroyed
 # (because key ["user03"] is not in for_each map)

Plan: 0 to add, 0 to change, 1 to destroy.
```

> Solo elimina el recurso eliminado de la lista.
